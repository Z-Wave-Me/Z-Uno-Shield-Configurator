!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ZUnoCompiler=t():e.ZUnoCompiler=t()}(self,(()=>(()=>{"use strict";var e={177:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ZUnoCompilerClass=void 0;const n=r(240);class i{constructor(e,t,r,o,n=null){this.SOF_CODE=1,this.NACK_CODE=21,this.CAN_CODE=24,this.ACK_CODE=6,this.REQUEST_CODE=0,this.RECV_OK=0,this.RECV_NOACK=1,this.RECV_INVALIDDATALEN=2,this.RECV_INVALIDCRC=3,this.RECV_NOSOF=5,this.dtr_timeout=250,this.rcv_sof_timeout=3500,this.ADDITIONAL_SIZE=3,this.ZUNO_HEADER_PREAMBL="ZMEZUNOC",this.SK_START_OFFSET_OLD=196608,this.SK_HEADER_SIZE=192,this.SK_HEADER_VERSION_MSB_OFFSET=8,this.SK_HEADER_VERSION_LSB_OFFSET=9,this.SK_HEADER_NAME_START=56,this.SK_HEADER_MAX_NAME=47,this.SK_HEADER_HWREW_OFFSET=this.SK_HEADER_NAME_START+this.SK_HEADER_MAX_NAME+1,this.ZUNO_LIC_FLAGS_NAMES_MAX_POWER=4,this.MAX_DEFAULT_RF_POWER=50,this.COM_PORT_FILTERS=[{usbVendorId:4292,usbProductId:6e4}],this.ZUNO_BAUD=[230400,460800,921600,115200],this.CRC_POLY=4129,this.variable_self=void 0,this.xhr_compile=void 0,this.xhr_version=void 0,this.xhr_bootloader=void 0,this.error_complite=!1,this.progressCbk=n,this.promise_wait=this.sketch(this,e,t,r,o)}progress(e,t,r){null!=e.progressCbk&&e.progressCbk(t,r)}calcSigmaCRC16(e,t,r,o,n){let i,s,a,l,u;const h=r;for(;0!=n;)for(n-=1,s=o>=h.length?255:h[o],o+=1,u=128;0!=u;)l=0,a=0,0!=(s&u)&&(l=1),0!=(32768&t)&&(a=1),i=l^a,t<<=1,t&=65535,1==i&&(t^=e.CRC_POLY),u>>=1;return t}Checksum(e){let t=255,r=0;for(;r<e.length;)t^=e[r],r++;return t}sleep(e){return new Promise((t=>setTimeout(t,e)))}write(e,t,r){return o(this,void 0,void 0,(function*(){const e=new Uint8Array(r),o=t.port.writable.getWriter();yield o.write(e),o.releaseLock()}))}sendNack(e,t){return o(this,void 0,void 0,(function*(){yield e.write(e,t,[e.NACK_CODE])}))}sendAck(e,t){return o(this,void 0,void 0,(function*(){yield e.write(e,t,[e.ACK_CODE])}))}readWithTimeout(e,t,r){return o(this,void 0,void 0,(function*(){let e;const o=t.port.readable.getReader(),n=setTimeout((()=>{o.releaseLock()}),r);try{e=(yield o.read()).value}catch(t){e=new Uint8Array([])}return clearTimeout(n),o.releaseLock(),e}))}read(e,t,r){return o(this,void 0,void 0,(function*(){let o,n,i,s;for(i=0;i<10;){if(t.queue.length>=r){for(o=[],n=0;n<r&&(s=t.queue.shift(),null!=s);)o.push(s),n++;return o}const a=yield e.readWithTimeout(e,t,100);for(n=0;n<a.byteLength;)t.queue.push(a[n]),n++;i++}for(r>=t.queue.length&&(r=t.queue.length),o=[],n=0;n<r&&(s=t.queue.shift(),null!=s);)o.push(s),n++;return o}))}clear(e,t){return o(this,void 0,void 0,(function*(){for(;;)if(0==(yield e.readWithTimeout(e,t,100)).length)return}))}waitSOF(e,t){return o(this,void 0,void 0,(function*(){const r=Date.now()+e.rcv_sof_timeout;for(;r>Date.now();){const r=yield e.read(e,t,1);if(0!=r.length){if(r[0]==e.SOF_CODE)return!0;yield e.sleep(200)}else yield e.sleep(100)}return!1}))}recvIncomingRequest(e,t){return o(this,void 0,void 0,(function*(){let r;if(0==(yield e.waitSOF(e,t)))return[e.RECV_NOSOF];if(r=yield e.read(e,t,1),0==r.length)return[e.RECV_NOSOF];const o=r[0];if(r=yield e.read(e,t,o),r.length!=o)return yield e.sendNack(e,t),[e.RECV_INVALIDDATALEN];const n=[o].concat(r.slice(0,o-1));return e.Checksum(n)!=r[o-1]?(yield e.sendNack(e,t),[e.RECV_INVALIDCRC]):(yield e.sendAck(e,t),[e.RECV_OK].concat(n))}))}resyncZunoPort(e,t){return o(this,void 0,void 0,(function*(){return(yield e.recvIncomingRequest(e,t))[0]==e.RECV_OK}))}sendData(e,t,r,n,i=!1){return o(this,void 0,void 0,(function*(){let o,s;if(s=n.length+e.ADDITIONAL_SIZE,1==i&&s++,s>255){const a=[0,e.REQUEST_CODE,r].concat(n);o=[0,s>>8&255,255&s,e.REQUEST_CODE,r].concat(n),1==i&&(o=o.concat([t.seqNo]));const l=e.calcSigmaCRC16(e,7439,a,0,a.length);return o=[e.SOF_CODE].concat(o).concat([l>>8&255,255&l]),yield e.write(e,t,o),t.seqNo+=1,void(t.seqNo&=255)}o=[255&s,e.REQUEST_CODE,r].concat(n),1==i&&(o=o.concat([t.seqNo]));const a=e.Checksum(o);o=[e.SOF_CODE].concat(o).concat([a]),yield e.write(e,t,o),t.seqNo+=1,t.seqNo&=255}))}sendCommandUnSz(e,t,r,n,i=!1,s=3){return o(this,void 0,void 0,(function*(){let o;for(yield e.clear(e,t);;){if(yield e.sendData(e,t,r,n,i),o=yield e.read(e,t,1),0==o.length)return[e.RECV_NOACK];if(o[0]==e.ACK_CODE)break;if(!(o[0]==e.CAN_CODE&&(yield e.recvIncomingRequest(e,t),(s-=1)>0)||o[0]==e.NACK_CODE&&(s-=1)>0))return[e.RECV_NOACK]}return yield e.recvIncomingRequest(e,t)}))}readNVM(e,t,r,n){return o(this,void 0,void 0,(function*(){return yield e.sendCommandUnSz(e,t,42,[r>>16&255,r>>8&255,255&r,n>>8&255,255&n],!1)}))}writeNVM(e,t,r,n){return o(this,void 0,void 0,(function*(){const o=n.length,i=[r>>16&255,r>>8&255,255&r,o>>8&255,255&o];return yield e.sendCommandUnSz(e,t,43,i.concat(n),!1)}))}checkBootImage(e,t){return o(this,void 0,void 0,(function*(){return e.sendCommandUnSz(e,t,8,[4],!1)}))}softReset(e,t){return o(this,void 0,void 0,(function*(){return e.sendCommandUnSz(e,t,8,[],!1)}))}pushSketch(e,t,r,n,i){return o(this,void 0,void 0,(function*(){return e.sendCommandUnSz(e,t,8,[1,r>>16&255,r>>8&255,255&r,n>>8&255,255&n,i>>8&255,255&i],!1)}))}freq_int_to_str(e){let t=0;for(;t<i.FREQ_TABLE_U7.length;){if(i.FREQ_TABLE_U7[t].id==e)return i.FREQ_TABLE_U7[t].name;t++}return null}freq_str_to_int(e){let t=0;if(null==e)return null;for(;t<i.FREQ_TABLE_U7.length;){if(i.FREQ_TABLE_U7[t].name==e)return i.FREQ_TABLE_U7[t].id;t++}return null}zme_costruct_int(e,t,r=!0){let o,n,i;for(o=0,n=0;n<e.length;)o<<=8,i=n,1==r&&(i=t-1-n),i<e.length&&i>=0&&(o+=e[i]),n++;return o}readBoardInfoCheckFlag(e,t){const r=(t-t%8)/8;return!(e.length<r)&&0!=(e[r]&1<<t%8)}conv2Decimal(e,t,r="-"){let o,n,i;for(n="",o=0;o<t.length/2;)i=t[2*o],i<<=8,i+=t[2*o+1],0!=o&&(n+=r),n+=e._compile_zwave_qrcode_padding(i,5),o+=1;return n}_compile_zwave_qrcode_padding(e,t){let r=e.toString(10);for(;r.length<t;)r="0"+r;return r}compile_zwave_qrcode(e,t,r,n){return o(this,void 0,void 0,(function*(){let o,i;i=e._compile_zwave_qrcode_padding(t.s2_keys,3),i+=e.conv2Decimal(e,r,""),i=i+"0010"+e._compile_zwave_qrcode_padding(t.device_type,5)+e._compile_zwave_qrcode_padding(t.device_icon,5),i=i+"0220"+e._compile_zwave_qrcode_padding(t.vendor,5)+e._compile_zwave_qrcode_padding(t.product_type,5)+e._compile_zwave_qrcode_padding(t.product_id,5)+e._compile_zwave_qrcode_padding(n,5),o=1,1==t.LR&&(o|=2),i+="0803"+e._compile_zwave_qrcode_padding(o,3),i+="0403005";const s=Uint8Array.from(unescape(encodeURIComponent(i)),(e=>e.charCodeAt(0))).buffer,a=new Uint8Array(yield crypto.subtle.digest("SHA-1",s));return i="9001"+e._compile_zwave_qrcode_padding(a[0]<<8|a[1],5)+i,i}))}toString(e){let t;t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}readBoardInfo(e,t){return o(this,void 0,void 0,(function*(){let r,o,n,i,s;const a={},l=yield e.readNVM(e,t,16776960,1);if(l.length<10)return a;if(o=yield e.readNVM(e,t,16769024,9),o.length<10)return a;r=!1,o=o.slice(4,o.length);const u=e.freq_int_to_str(o[1]);if(null==u)return a;null!=u&&("US_LR"!=u&&"US"!=u&&"US_LR_BK"!=u||(r=!0)),a.freq_i=o[1],a.freq_str=u;const h=l.slice(4,l.length);if(a.version=h[0]<<8|h[1],a.build_number=h[2]<<24|h[3]<<16|h[4]<<8|h[5],a.build_ts=h[6]<<24|h[7]<<16|h[8]<<8|h[9],a.hw_rev=h[10]<<8|h[11],n=0,a.build_number>1116?(n=1,a.code_size=e.zme_costruct_int(h.slice(12,15),3,!1)):a.code_size=h[12]<<8|h[13],a.ram_size=h[14+n]<<8|h[15+n],a.chip_uid=h.slice(16+n,16+n+8),a.s2_pub=h.slice(24+n,24+n+16),a.dsk=e.conv2Decimal(e,a.s2_pub,"-"),a.dbg_lock=255,a.home_id=0,a.node_id=0,a.custom_code_offset=e.SK_START_OFFSET_OLD,h.length>44+n&&(a.dbg_lock=h[40+n],a.home_id=e.zme_costruct_int(h.slice(41+n,41+n+4),4,!1),a.node_id=h[45+n]),i=11,h.length>46+n&&(a.build_number<1669?(i=90,a.smart_qr=e.toString(h.slice(46+n,46+n+90))):(a.zwdata={s2_keys:h[46+n],device_type:e.zme_costruct_int(h.slice(47+n,47+n+2),2,!1),device_icon:e.zme_costruct_int(h.slice(49+n,49+n+2),2,!1),vendor:e.zme_costruct_int(h.slice(51+n,51+n+2),2,!1),product_type:e.zme_costruct_int(h.slice(53+n,53+n+2),2,!1),product_id:e.zme_costruct_int(h.slice(55+n,55+n+2),2,!1),version:a.version,LR:r},a.smart_qr=yield e.compile_zwave_qrcode(e,a.zwdata,a.s2_pub,a.version))),a.boot_offset=237568,h.length>46+i+n+4&&(a.custom_code_offset=e.zme_costruct_int(h.slice(46+n+i,46+n+i+4),4,!1),a.custom_code_offset>221184&&(a.boot_offset=262144)),a.max_default_power=e.MAX_DEFAULT_RF_POWER,s=[0],h.length>46+i+n+8){const e=46+n+i+4+8+4+4;s=h.slice(e+2,e+2+8),h.length>e+10&&a.build_number>=2849&&(a.max_default_power=h[e+10])}return 0==e.readBoardInfoCheckFlag(s,e.ZUNO_LIC_FLAGS_NAMES_MAX_POWER)?a.flag_max_power=!1:a.flag_max_power=!0,a.param_info=o,a}))}freezeSketch(e,t){return o(this,void 0,void 0,(function*(){let r,o,n;for(n=3,r=10,"Win32"==navigator.platform&&(r=50);0!=n;){if(o=yield e.sendCommandUnSz(e,t,8,[2],!1),o.length>4&&o[0]==e.RECV_OK&&8==o[3]&&0==o[4])return!0;yield e.sleep(r),n-=1}return!1}))}syncWithDevice(e,t){return o(this,void 0,void 0,(function*(){return 0!=(yield e.resyncZunoPort(e,t))&&0!=(yield e.freezeSketch(e,t))}))}HeaderCmp(e,t,r,o,n){const i=new Uint8Array(t.slice(0,e.ZUNO_HEADER_PREAMBL.length)),s=(new TextDecoder).decode(i);return e.ZUNO_HEADER_PREAMBL==s&&((t[e.SK_HEADER_VERSION_MSB_OFFSET]<<8|t[e.SK_HEADER_VERSION_LSB_OFFSET])==r&&!(-1!=o&&n>=2849&&o!=e.zme_costruct_int(t.slice(e.SK_HEADER_HWREW_OFFSET,e.SK_HEADER_HWREW_OFFSET+2),2)))}writeArrayToNVM(e,t,r,n,i,s=0){return o(this,void 0,void 0,(function*(){let o,a,l,u,h,c;const d=i;for(a=s,l=d.length-s,o=240,null!=r.build_number&&r.build_number>=3396&&(o=2048);0!=l;){if(u=o,l<o&&(u=l),h=[],h=h.concat(d.slice(a,a+u)),1==h.length&&(h=h.concat([255])),c=yield e.writeNVM(e,t,n,h),c[0]!=e.RECV_OK||1!=c[4])return null;a+=u,l-=u,n+=u}return d}))}applyPrams(e,t,r){return o(this,void 0,void 0,(function*(){const o=r.param_info;if(null==o||null==t.paramtr)return!1;for(;o.length<8;)o.push(0);o[1]=t.paramtr.freq,o.length>8&&(o[8]=t.paramtr.freq),o[4]=t.paramtr.sec,o[2]=t.paramtr.main_pow;const n=yield e.writeNVM(e,t,16769024,o);return n[0]==e.RECV_OK&&1==n[4]}))}waitFinware(e,t){return o(this,void 0,void 0,(function*(){const r=Date.now()+3e4;for(;r>Date.now();){const r=yield e.recvIncomingRequest(e,t);if(r[0]==e.RECV_OK)return!(r.length<6)&&8==r[3]&&1==r[5];yield e.sleep(100)}return!1}))}_base64ToArrayBuffer(e){const t=atob(e),r=new Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}_xhr_compile(e,t,r){return new Promise((function(o,n){const i=new FormData;i.append("sketch",new File([new Blob([t])],"sketch",{lastModified:Date.now(),type:"text/x-arduino"})),i.append("referer",document.location.href);const s="https://service.z-wave.me/z-uno-compilation-server/?compile&hw="+r;e.open("POST",s),e.responseType="json",e.timeout=3e5,e.ontimeout=function(){n(Error("Request failed: Timed out"))},e.onload=function(){o(e.response)},e.onerror=function(){n(Error("Request failed: Perhaps you have problems with the Internet"))},e.send(i)}))}_xhr_version(e){return new Promise((function(t,r){e.open("POST","https://service.z-wave.me/z-uno-compilation-server/?version"),e.responseType="json",e.timeout=3e4,e.ontimeout=function(){r(Error("Request failed: Timed out"))},e.onload=function(){t(e.response)},e.onerror=function(){r(Error("Request failed: Perhaps you have problems with the Internet"))},e.send()}))}_xhr_bootloader(e,t,r){return new Promise((function(o,n){const i="https://service.z-wave.me/z-uno-compilation-server/?bootloader&hw="+t+"&seq="+r;e.open("POST",i),e.responseType="json",e.timeout=3e4,e.ontimeout=function(){n(Error("Request failed: Timed out"))},e.onload=function(){o(e.response)},e.onerror=function(){n(Error("Request failed: Perhaps you have problems with the Internet"))},e.send()}))}sketch_info(e,t){e.progress(e,"info",t)}sketch_error(e,t,r,n){return o(this,void 0,void 0,(function*(){null!=t&&(yield t.port.close()),e.progress(e,"error",n.message),r(n)}))}load_sketch(e,t,r,n,i){e.sketch_info(e,"Compiling the sketch..."),r.then((function(r){return o(this,void 0,void 0,(function*(){let o;try{if(0!=r.status)return e.error_complite=!0,e.sketch_error(e,t,i,Error("Compilation returned incorrect status: "+r.status+" log: "+r.log+" message: "+r.message));o=e._base64ToArrayBuffer(r.bin)}catch(r){return e.sketch_error(e,t,i,Error("The structure obtained after compilation is not valid"))}e.sketch_info(e,"Compiling the sketch done");const s=t.md;if(null==s||null==s.version||null==s.hw_rev||null==s.build_number||null==s.custom_code_offset||null==s.code_size)return e.sketch_error(e,t,i,Error("Something unexpected happened and the variable turned out to be empty - contact support."));const a=o.slice(0,e.SK_HEADER_SIZE);if(0==e.HeaderCmp(e,a,s.version,s.hw_rev,s.build_number))return e.sketch_error(e,t,i,Error("The sketch and firmware version do not match"));if(o.length>s.code_size)return e.sketch_error(e,t,i,Error("Sketch size too large"));if(e.sketch_info(e,"Uploading the sketch..."),0==(yield e.applyPrams(e,t,s)))return e.sketch_error(e,t,i,Error("Failed to apply settings"));const l=yield e.writeArrayToNVM(e,t,s,s.custom_code_offset,o);if(null==l)return e.sketch_error(e,t,i,Error("Failed to upload sketch"));const u=e.calcSigmaCRC16(e,7439,l,0,l.length),h=yield e.pushSketch(e,t,s.custom_code_offset,l.length,u);if(h[0]!=e.RECV_OK)return e.sketch_error(e,t,i,Error("Failed to apply sketch"));if(254==h[4])return e.sketch_error(e,t,i,Error("Can't upload sketch! Something went wrong. Bad CRC16 :'( ."));yield t.port.close(),e.sketch_info(e,"Uploading the sketch done"),e.sketch_info(e,"QR code read..."),yield e.sleep(e.dtr_timeout);try{yield t.port.open({baudRate:t.baudRate,bufferSize:8192})}catch(t){return e.sketch_error(e,null,i,Error("Check yours, maybe another application is using it"))}if(0==(yield e.syncWithDevice(e,t)))return e.sketch_error(e,null,i,Error("After a successful firmware update, it was not possible to re-sync with Z-Uno"));if(t.md=yield e.readBoardInfo(e,t),0==Object.keys(t.md).length)return e.sketch_error(e,t,i,Error("Failed to read board info"));yield e.softReset(e,t),yield t.port.close();const c={};return c.dsk=t.md.dsk,"smart_qr"in t.md?(c.smart_qr=t.md.smart_qr,e.sketch_info(e,"QR code read done"),void n(c)):e.sketch_error(e,t,i,Error("Failed to read QR code"))}))}),(function(r){return o(this,void 0,void 0,(function*(){return e.sketch_error(e,t,i,r)}))}))}load_bootloader(e,t,r,n,i,s,a){e.sketch_info(e,"Uploading a new bootloader to the Z-Uno...");const l=new XMLHttpRequest,u=e._xhr_bootloader(l,s,a);e.xhr_bootloader=l,u.then((function(s){return o(this,void 0,void 0,(function*(){let o;try{if(0!=s.status)return e.sketch_error(e,t,i,Error("Get bootloader returned incorrect status: "+s.status+" log: "+s.log+" message: "+s.message));o=e._base64ToArrayBuffer(s.bin)}catch(r){return e.sketch_error(e,t,i,Error("The bootloader structure obtained after version is not valid"))}if(null==t.md||null==t.md.boot_offset)return e.sketch_error(e,t,i,Error("Something unexpected happened and the variable turned out to be empty - contact support."));if(null==(yield e.writeArrayToNVM(e,t,t.md,t.md.boot_offset,o)))return e.sketch_error(e,t,i,Error("Failed to upload firmware"));if(yield e.checkBootImage(e,t),0==(yield e.waitFinware(e,t)))return e.sketch_error(e,t,i,Error("Something is wrong - the firmware could not be updated - there may be a problem with the version"));yield e.waitFinware(e,t),yield t.port.close(),yield e.sleep(e.dtr_timeout);try{yield t.port.open({baudRate:t.baudRate,bufferSize:8192})}catch(t){return e.sketch_error(e,null,i,Error("Check yours, maybe another application is using it"))}return 0==(yield e.syncWithDevice(e,t))?e.sketch_error(e,null,i,Error("After a successful firmware update, it was not possible to re-sync with Z-Uno")):(t.md=yield e.readBoardInfo(e,t),0==Object.keys(t.md).length?e.sketch_error(e,t,i,Error("Failed to read board info")):Number(a)!=t.md.build_number?e.sketch_error(e,t,i,Error("Although the firmware was successfully updated, the actual version was no longer needed")):(e.sketch_info(e,"Uploading a new bootloader to the Z-Uno done"),e.load_sketch(e,t,r,n,i)))}))}),(function(r){return o(this,void 0,void 0,(function*(){return e.sketch_error(e,t,i,r)}))}))}sketch(e,t,r,n,i){return o(this,void 0,void 0,(function*(){return new Promise((function(s,a){return o(this,void 0,void 0,(function*(){let l,u,h,c;const d=e.COM_PORT_FILTERS;if(!navigator.serial||!navigator.serial.requestPort)return e.sketch_error(e,null,a,Error("Sorry, this feature is supported only on Chrome, Edge and Opera"));try{c=yield navigator.serial.requestPort({filters:d})}catch(t){return e.sketch_error(e,null,a,Error("No port selected"))}try{yield c.close()}catch(e){}e.sketch_info(e,"Determining the revision Z-Uno ...");const _={queue:[],seqNo:0,port:c,baudRate:230400};for(e.variable_self=_,l=0;l<e.ZUNO_BAUD.length;){try{yield _.port.open({baudRate:e.ZUNO_BAUD[l],bufferSize:8192})}catch(t){return e.sketch_error(e,null,a,Error("Check yours, maybe another application is using it"))}if(1==(yield e.syncWithDevice(e,_)))break;yield _.port.close(),yield e.sleep(e.dtr_timeout),l++}if(l>=e.ZUNO_BAUD.length)return e.sketch_error(e,null,a,Error("Failed to sync with Z-Uno"));if(_.baudRate=e.ZUNO_BAUD[l],_.md=yield e.readBoardInfo(e,_),0==Object.keys(_.md).length)return e.sketch_error(e,_,a,Error("Failed to read board info"));if(e.sketch_info(e,"Determining the revision Z-Uno done"),null==_.md.freq_str)return e.sketch_error(e,_,a,Error("Something unexpected happened and the variable turned out to be empty - contact support."));null==r&&(r=_.md.freq_str);const f=e.freq_str_to_int(r);if(!0===n)h=1;else{if(!1!==n)return e.sketch_error(e,null,a,Error("The security parameter is incorrectly specified"));h=0}if(null==_.md.max_default_power)return e.sketch_error(e,_,a,Error("Something unexpected happened and the variable turned out to be empty - contact support."));if(i<1||i>255)return e.sketch_error(e,null,a,Error("Radio power is out of range"));if(null==f)return e.sketch_error(e,null,a,Error("The specified radio frequency is not supported"));if(0==_.md.flag_max_power&&i>_.md.max_default_power)return e.sketch_error(e,_,a,Error("Your license does not support this maximum radio power value."));if(_.paramtr={main_pow:i,freq:f,sec:h},null==_.md.hw_rev)return e.sketch_error(e,_,a,Error("Something unexpected happened and the variable turned out to be empty - contact support."));for(u=_.md.hw_rev.toString(16);u.length<4;)u="0"+u;e.sketch_info(e,"Checking Z-Uno version...");const p=new XMLHttpRequest,m=e._xhr_version(p);e.xhr_version=p;const g=new XMLHttpRequest;e.xhr_compile=g;const v=e._xhr_compile(g,t,u);m.then((function(t){return o(this,void 0,void 0,(function*(){let r;try{if(0!=t.status)return e.sketch_error(e,_,a,Error("Get version returned incorrect status: "+t.status+" message: "+t.message));r=t.version.hw}catch(t){return e.sketch_error(e,_,a,Error("The version structure obtained after version is not valid"))}const o=r[u].seq;return void 0===o?e.sketch_error(e,_,a,Error("The server does not support the specified board revision")):null==_.md||null==_.md.build_number?e.sketch_error(e,_,a,Error("Something unexpected happened and the variable turned out to be empty - contact support.")):_.md.build_number>o?e.sketch_error(e,_,a,Error("The firmware on the board is newer than on the server")):(e.sketch_info(e,"Checking Z-Uno version done"),_.md.build_number!=o?e.load_bootloader(e,_,v,s,a,u,String(o)):e.load_sketch(e,_,v,s,a))}))}),(function(t){return o(this,void 0,void 0,(function*(){return e.sketch_error(e,_,a,t)}))}))}))}))}))}generateQrCode(e,t,r){let o;const i={text:r,width:256,height:256,colorDark:"#000000",colorLight:"#ffffff",correctLevel:1};try{o=new n.QRCode(t,i)}catch(t){return e.progress(e,"error",'Failed to create "object QRCode", check parameters.'),!1}return!0}getWait(){return this.promise_wait}errorComplite(){return this.error_complite}cancel(){try{null!=this.variable_self&&this.variable_self.port.close()}catch(e){}try{null!=this.xhr_version&&this.xhr_version.abort()}catch(e){}try{null!=this.xhr_bootloader&&this.xhr_bootloader.abort()}catch(e){}try{null!=this.xhr_compile&&this.xhr_compile.abort()}catch(e){}}drawQR(e,t){return this.generateQrCode(this,e,t)}static getFreqList(){let e;e=0;const t=[];for(;e<i.FREQ_TABLE_U7.length;)t.push(i.FREQ_TABLE_U7[e].name),e++;return t}}t.ZUnoCompilerClass=i,i.FREQ_TABLE_U7=[{name:"EU",id:0},{name:"US",id:1},{name:"ANZ",id:2},{name:"HK",id:3},{name:"IN",id:5},{name:"IL",id:6},{name:"RU",id:7},{name:"CN",id:8},{name:"US_LR",id:9},{name:"JP",id:32},{name:"KR",id:33}]},240:(e,t,r)=>{var o;r.r(t),r.d(t,{QRCode:()=>o}),function(){function e(e){this.mode=r.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var t=0,o=this.data.length;t<o;t++){var n=[],i=this.data.charCodeAt(t);i>65536?(n[0]=240|(1835008&i)>>>18,n[1]=128|(258048&i)>>>12,n[2]=128|(4032&i)>>>6,n[3]=128|63&i):i>2048?(n[0]=224|(61440&i)>>>12,n[1]=128|(4032&i)>>>6,n[2]=128|63&i):i>128?(n[0]=192|(1984&i)>>>6,n[1]=128|63&i):n[0]=i,this.parsedData.push(n)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function t(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}e.prototype={getLength:function(e){return this.parsedData.length},write:function(e){for(var t=0,r=this.parsedData.length;t<r;t++)e.put(this.parsedData[t],8)}},t.prototype={addData:function(t){var r=new e(t);this.dataList.push(r),this.dataCache=null},isDark:function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,r){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var o=0;o<this.moduleCount;o++){this.modules[o]=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++)this.modules[o][n]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,r),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=t.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,r)},setupPositionProbePattern:function(e,t){for(var r=-1;r<=7;r++)if(!(e+r<=-1||this.moduleCount<=e+r))for(var o=-1;o<=7;o++)t+o<=-1||this.moduleCount<=t+o||(this.modules[e+r][t+o]=0<=r&&r<=6&&(0==o||6==o)||0<=o&&o<=6&&(0==r||6==r)||2<=r&&r<=4&&2<=o&&o<=4)},getBestMaskPattern:function(){for(var e=0,t=0,r=0;r<8;r++){this.makeImpl(!0,r);var o=i.getLostPoint(this);(0==r||e>o)&&(e=o,t=r)}return t},createMovieClip:function(e,t,r){var o=e.createEmptyMovieClip(t,r);this.make();for(var n=0;n<this.modules.length;n++)for(var i=1*n,s=0;s<this.modules[n].length;s++){var a=1*s;this.modules[n][s]&&(o.beginFill(0,100),o.moveTo(a,i),o.lineTo(a+1,i),o.lineTo(a+1,i+1),o.lineTo(a,i+1),o.endFill())}return o},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)},setupPositionAdjustPattern:function(){for(var e=i.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var r=0;r<e.length;r++){var o=e[t],n=e[r];if(null==this.modules[o][n])for(var s=-2;s<=2;s++)for(var a=-2;a<=2;a++)this.modules[o+s][n+a]=-2==s||2==s||-2==a||2==a||0==s&&0==a}},setupTypeNumber:function(e){for(var t=i.getBCHTypeNumber(this.typeNumber),r=0;r<18;r++){var o=!e&&1==(t>>r&1);this.modules[Math.floor(r/3)][r%3+this.moduleCount-8-3]=o}for(r=0;r<18;r++)o=!e&&1==(t>>r&1),this.modules[r%3+this.moduleCount-8-3][Math.floor(r/3)]=o},setupTypeInfo:function(e,t){for(var r=this.errorCorrectLevel<<3|t,o=i.getBCHTypeInfo(r),n=0;n<15;n++){var s=!e&&1==(o>>n&1);n<6?this.modules[n][8]=s:n<8?this.modules[n+1][8]=s:this.modules[this.moduleCount-15+n][8]=s}for(n=0;n<15;n++)s=!e&&1==(o>>n&1),n<8?this.modules[8][this.moduleCount-n-1]=s:n<9?this.modules[8][15-n-1+1]=s:this.modules[8][15-n-1]=s;this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var r=-1,o=this.moduleCount-1,n=7,s=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var l=0;l<2;l++)if(null==this.modules[o][a-l]){var u=!1;s<e.length&&(u=1==(e[s]>>>n&1)),i.getMask(t,o,a-l)&&(u=!u),this.modules[o][a-l]=u,-1==--n&&(s++,n=7)}if((o+=r)<0||this.moduleCount<=o){o-=r,r=-r;break}}}},t.PAD0=236,t.PAD1=17,t.createData=function(e,r,o){for(var n=u.getRSBlocks(e,r),s=new h,a=0;a<o.length;a++){var l=o[a];s.put(l.mode,4),s.put(l.getLength(),i.getLengthInBits(l.mode,e)),l.write(s)}var c=0;for(a=0;a<n.length;a++)c+=n[a].dataCount;if(s.getLengthInBits()>8*c)throw new Error("code length overflow. ("+s.getLengthInBits()+">"+8*c+")");for(s.getLengthInBits()+4<=8*c&&s.put(0,4);s.getLengthInBits()%8!=0;)s.putBit(!1);for(;!(s.getLengthInBits()>=8*c||(s.put(t.PAD0,8),s.getLengthInBits()>=8*c));)s.put(t.PAD1,8);return t.createBytes(s,n)},t.createBytes=function(e,t){for(var r=0,o=0,n=0,s=new Array(t.length),a=new Array(t.length),u=0;u<t.length;u++){var h=t[u].dataCount,c=t[u].totalCount-h;o=Math.max(o,h),n=Math.max(n,c),s[u]=new Array(h);for(var d=0;d<s[u].length;d++)s[u][d]=255&e.buffer[d+r];r+=h;var _=i.getErrorCorrectPolynomial(c),f=new l(s[u],_.getLength()-1).mod(_);for(a[u]=new Array(_.getLength()-1),d=0;d<a[u].length;d++){var p=d+f.getLength()-a[u].length;a[u][d]=p>=0?f.get(p):0}}var m=0;for(d=0;d<t.length;d++)m+=t[d].totalCount;var g=new Array(m),v=0;for(d=0;d<o;d++)for(u=0;u<t.length;u++)d<s[u].length&&(g[v++]=s[u][d]);for(d=0;d<n;d++)for(u=0;u<t.length;u++)d<a[u].length&&(g[v++]=a[u][d]);return g};for(var r={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},n={L:1,M:0,Q:3,H:2},i={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;i.getBCHDigit(t)-i.getBCHDigit(i.G15)>=0;)t^=i.G15<<i.getBCHDigit(t)-i.getBCHDigit(i.G15);return(e<<10|t)^i.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;i.getBCHDigit(t)-i.getBCHDigit(i.G18)>=0;)t^=i.G18<<i.getBCHDigit(t)-i.getBCHDigit(i.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return i.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,r){switch(e){case 0:return(t+r)%2==0;case 1:return t%2==0;case 2:return r%3==0;case 3:return(t+r)%3==0;case 4:return(Math.floor(t/2)+Math.floor(r/3))%2==0;case 5:return t*r%2+t*r%3==0;case 6:return(t*r%2+t*r%3)%2==0;case 7:return(t*r%3+(t+r)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new l([1],0),r=0;r<e;r++)t=t.multiply(new l([1,s.gexp(r)],0));return t},getLengthInBits:function(e,t){if(1<=t&&t<10)switch(e){case r.MODE_NUMBER:return 10;case r.MODE_ALPHA_NUM:return 9;case r.MODE_8BIT_BYTE:case r.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case r.MODE_NUMBER:return 12;case r.MODE_ALPHA_NUM:return 11;case r.MODE_8BIT_BYTE:return 16;case r.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case r.MODE_NUMBER:return 14;case r.MODE_ALPHA_NUM:return 13;case r.MODE_8BIT_BYTE:return 16;case r.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),r=0,o=0;o<t;o++)for(var n=0;n<t;n++){for(var i=0,s=e.isDark(o,n),a=-1;a<=1;a++)if(!(o+a<0||t<=o+a))for(var l=-1;l<=1;l++)n+l<0||t<=n+l||0==a&&0==l||s==e.isDark(o+a,n+l)&&i++;i>5&&(r+=3+i-5)}for(o=0;o<t-1;o++)for(n=0;n<t-1;n++){var u=0;e.isDark(o,n)&&u++,e.isDark(o+1,n)&&u++,e.isDark(o,n+1)&&u++,e.isDark(o+1,n+1)&&u++,0!=u&&4!=u||(r+=3)}for(o=0;o<t;o++)for(n=0;n<t-6;n++)e.isDark(o,n)&&!e.isDark(o,n+1)&&e.isDark(o,n+2)&&e.isDark(o,n+3)&&e.isDark(o,n+4)&&!e.isDark(o,n+5)&&e.isDark(o,n+6)&&(r+=40);for(n=0;n<t;n++)for(o=0;o<t-6;o++)e.isDark(o,n)&&!e.isDark(o+1,n)&&e.isDark(o+2,n)&&e.isDark(o+3,n)&&e.isDark(o+4,n)&&!e.isDark(o+5,n)&&e.isDark(o+6,n)&&(r+=40);var h=0;for(n=0;n<t;n++)for(o=0;o<t;o++)e.isDark(o,n)&&h++;return r+Math.abs(100*h/t/t-50)/5*10}},s={glog:function(e){if(e<1)throw new Error("glog("+e+")");return s.LOG_TABLE[e]},gexp:function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return s.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},a=0;a<8;a++)s.EXP_TABLE[a]=1<<a;for(a=8;a<256;a++)s.EXP_TABLE[a]=s.EXP_TABLE[a-4]^s.EXP_TABLE[a-5]^s.EXP_TABLE[a-6]^s.EXP_TABLE[a-8];for(a=0;a<255;a++)s.LOG_TABLE[s.EXP_TABLE[a]]=a;function l(e,t){if(null==e.length)throw new Error(e.length+"/"+t);for(var r=0;r<e.length&&0==e[r];)r++;this.num=new Array(e.length-r+t);for(var o=0;o<e.length-r;o++)this.num[o]=e[o+r]}function u(e,t){this.totalCount=e,this.dataCount=t}function h(){this.buffer=[],this.length=0}l.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),r=0;r<this.getLength();r++)for(var o=0;o<e.getLength();o++)t[r+o]^=s.gexp(s.glog(this.get(r))+s.glog(e.get(o)));return new l(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=s.glog(this.get(0))-s.glog(e.get(0)),r=new Array(this.getLength()),o=0;o<this.getLength();o++)r[o]=this.get(o);for(o=0;o<e.getLength();o++)r[o]^=s.gexp(s.glog(e.get(o))+t);return new l(r,0).mod(e)}},u.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],u.getRSBlocks=function(e,t){var r=u.getRsBlockTable(e,t);if(null==r)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var o=r.length/3,n=[],i=0;i<o;i++)for(var s=r[3*i+0],a=r[3*i+1],l=r[3*i+2],h=0;h<s;h++)n.push(new u(a,l));return n},u.getRsBlockTable=function(e,t){switch(t){case n.L:return u.RS_BLOCK_TABLE[4*(e-1)+0];case n.M:return u.RS_BLOCK_TABLE[4*(e-1)+1];case n.Q:return u.RS_BLOCK_TABLE[4*(e-1)+2];case n.H:return u.RS_BLOCK_TABLE[4*(e-1)+3];default:return}},h.prototype={get:function(e){var t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(var r=0;r<t;r++)this.putBit(1==(e>>>t-r-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var c=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];function d(){var e=!1,t=navigator.userAgent;if(/android/i.test(t)){e=!0;var r=t.toString().match(/android ([0-9]\.[0-9])/i);r&&r[1]&&(e=parseFloat(r[1]))}return e}var _=function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){var t=this._htOption,r=this._el,o=e.getModuleCount();function n(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg",e);for(var o in t)t.hasOwnProperty(o)&&r.setAttribute(o,t[o]);return r}Math.floor(t.width/o),Math.floor(t.height/o),this.clear();var i=n("svg",{viewBox:"0 0 "+String(o)+" "+String(o),width:"100%",height:"100%",fill:t.colorLight});i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.appendChild(i),i.appendChild(n("rect",{fill:t.colorLight,width:"100%",height:"100%"})),i.appendChild(n("rect",{fill:t.colorDark,width:"1",height:"1",id:"template"}));for(var s=0;s<o;s++)for(var a=0;a<o;a++)if(e.isDark(s,a)){var l=n("use",{x:String(s),y:String(a)});l.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),i.appendChild(l)}},e.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},e}(),f="svg"===document.documentElement.tagName.toLowerCase()?_:"undefined"==typeof CanvasRenderingContext2D?function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){for(var t=this._htOption,r=this._el,o=e.getModuleCount(),n=Math.floor(t.width/o),i=Math.floor(t.height/o),s=['<table style="border:0;border-collapse:collapse;">'],a=0;a<o;a++){s.push("<tr>");for(var l=0;l<o;l++)s.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+n+"px;height:"+i+"px;background-color:"+(e.isDark(a,l)?t.colorDark:t.colorLight)+';"></td>');s.push("</tr>")}s.push("</table>"),r.innerHTML=s.join("");var u=r.childNodes[0],h=(t.width-u.offsetWidth)/2,c=(t.height-u.offsetHeight)/2;h>0&&c>0&&(u.style.margin=c+"px "+h+"px")},e.prototype.clear=function(){this._el.innerHTML=""},e}():function(){function e(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}if(null!=this&&this._android&&this._android<=2.1){var t=1/window.devicePixelRatio,r=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(e,o,n,i,s,a,l,u,h){if("nodeName"in e&&/img/i.test(e.nodeName))for(var c=arguments.length-1;c>=1;c--)arguments[c]=arguments[c]*t;else void 0===u&&(arguments[1]*=t,arguments[2]*=t,arguments[3]*=t,arguments[4]*=t);r.apply(this,arguments)}}function o(e,t){var r=this;if(r._fFail=t,r._fSuccess=e,null===r._bSupportDataURI){var o=document.createElement("img"),n=function(){r._bSupportDataURI=!1,r._fFail&&r._fFail.call(r)};return o.onabort=n,o.onerror=n,o.onload=function(){r._bSupportDataURI=!0,r._fSuccess&&r._fSuccess.call(r)},void(o.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}!0===r._bSupportDataURI&&r._fSuccess?r._fSuccess.call(r):!1===r._bSupportDataURI&&r._fFail&&r._fFail.call(r)}var n=function(e,t){this._bIsPainted=!1,this._android=d(),this._htOption=t,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=t.width,this._elCanvas.height=t.height,e.appendChild(this._elCanvas),this._el=e,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.alt="Scan me!",this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return n.prototype.draw=function(e){var t=this._elImage,r=this._oContext,o=this._htOption,n=e.getModuleCount(),i=o.width/n,s=o.height/n,a=Math.round(i),l=Math.round(s);t.style.display="none",this.clear();for(var u=0;u<n;u++)for(var h=0;h<n;h++){var c=e.isDark(u,h),d=h*i,_=u*s;r.strokeStyle=c?o.colorDark:o.colorLight,r.lineWidth=1,r.fillStyle=c?o.colorDark:o.colorLight,r.fillRect(d,_,i,s),r.strokeRect(Math.floor(d)+.5,Math.floor(_)+.5,a,l),r.strokeRect(Math.ceil(d)-.5,Math.ceil(_)-.5,a,l)}this._bIsPainted=!0},n.prototype.makeImage=function(){this._bIsPainted&&o.call(this,e)},n.prototype.isPainted=function(){return this._bIsPainted},n.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},n.prototype.round=function(e){return e?Math.floor(1e3*e)/1e3:e},n}();o=function(e,t){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:n.H},"string"==typeof t&&(t={text:t}),t)for(var r in t)this._htOption[r]=t[r];"string"==typeof e&&(e=document.getElementById(e)),this._htOption.useSVG&&(f=_),this._android=d(),this._el=e,this._oQRCode=null,this._oDrawing=new f(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},o.prototype.makeCode=function(e){this._oQRCode=new t(function(e,t){for(var r=1,o=function(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e?3:0)}(e),i=0,s=c.length;i<=s;i++){var a=0;switch(t){case n.L:a=c[i][0];break;case n.M:a=c[i][1];break;case n.Q:a=c[i][2];break;case n.H:a=c[i][3]}if(o<=a)break;r++}if(r>c.length)throw new Error("Too long data");return r}(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._el.title=e,this._oDrawing.draw(this._oQRCode),this.makeImage()},o.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},o.prototype.clear=function(){this._oDrawing.clear()},o.CorrectLevel=n}()}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,r),i.exports}return r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(177)})()));