<!--TODO если на вкладке есть неразрешенные конфлиты рисовать алерт напротив переменной и на вкладке-->
<div [formGroup]="form" class="rules">
  <ng-container formArrayName="rules">
    <ng-container *ngFor="let ruleForm of form.controls.rules.controls; let ruleIndex = index">
      <div [formGroup]="ruleForm" class="rule">
        <div class="label" i18n>
          Condition
          <button mat-icon-button (click)="addExpression(ruleForm.controls.expressions)"><mat-icon>add_circle_outline</mat-icon></button>
        </div>
        <div *ngFor="let expression of ruleForm.controls.expressions.controls; let expressionIndex = index; let first = first" class="row">
          <configurator-expression [formControl]="expression" [first]="first"></configurator-expression>
          <button *ngIf="expressionIndex" mat-icon-button (click)="removeExpression(ruleForm.controls.expressions, expressionIndex)"><mat-icon>delete</mat-icon></button>
        </div>
        <div class="label">
          Condition fulfilled
          <button mat-icon-button (click)="addAction(ruleForm.controls.actions)"><mat-icon>add_circle_outline</mat-icon></button>
        </div>
        <div *ngFor="let action of ruleForm.controls.actions.controls; let actionIndex = index" class="row">
          <configurator-action [formControl]="action"></configurator-action>
          <button mat-icon-button (click)="removeAction(ruleForm.controls.actions, actionIndex)"><mat-icon>delete</mat-icon></button>
        </div>
        <div class="label">
          Otherwise
          <button mat-icon-button (click)="addAction(ruleForm.controls.elseBlock)"><mat-icon>add_circle_outline</mat-icon></button>

        </div>
          <div *ngFor="let action of ruleForm.controls.elseBlock.controls; let elseIndex = index" class="row">
            <configurator-action [formControl]="action"></configurator-action>
            <button mat-icon-button (click)="removeAction(ruleForm.controls.elseBlock, elseIndex)"><mat-icon>delete</mat-icon></button>
          </div>


        <button class="remove-button" mat-icon-button (click)="removeRule(ruleIndex)"><mat-icon>delete</mat-icon></button>
      </div>
    </ng-container>
    <button mat-raised-button (click)="addRule()">AddRule</button>
  </ng-container>
</div>
